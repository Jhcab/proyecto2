define("wixCode/utils/wixCodeWidgetService",["lodash","platformInit"],function(e,t){"use strict";function i(e){return t.specMapUtils.getAppSpec(e)}return{hasWixCodeWidgetSpecs:function(e){return!!i(e)},getWixCodeSpec:i}}),define("wixCode/aspects/WixCodeWidgetAspect",["lodash","platformInit","coreUtils"],function(e,t,i){"use strict";function n(e){var t=this;this._aspectSiteAPI=e,this._aspectSiteAPI.registerToSiteReady(function(){var e=t._aspectSiteAPI.getSiteAspect("siteMembers");t.callbackId=e.registerToUserLogin(function(){t.isAppInitiated()||t.initApp(),e.unRegisterToUserLogin(t.callbackId)})})}return n.prototype={initApp:function(){var n=this._aspectSiteAPI.getSiteData(),a=this._aspectSiteAPI.getWixCodeAppApi(),s=e.get(n,["currentUrl","query","viewerPlatformAppSources"]),r=t.appsUtils.getAppsBaseInfo({rendererModel:n.rendererModel,clientSpecMap:n.getClientSpecMap(),serviceTopology:n.serviceTopology,viewerPlatformAppSources:s}),o="lib/"+(n.hasDebugQueryParam()?"wix.js":"wix.min.js"),d=i.urlUtils.joinURL(n.serviceTopology.scriptsLocationMap["js-wixcode-sdk"],o),c=n.hasDebugQueryParam()?"wixcode-namespaces.js":"wixcode-namespaces.min.js",u=i.urlUtils.joinURL(n.serviceTopology.scriptsLocationMap["wixcode-namespaces"],c),p="//unpkg.parastorage.com/react@16.0.0/umd/react"+(n.hasDebugQueryParam()?".development.js":".production.min.js"),l="//unpkg.parastorage.com/react-dom@16.0.0/umd/react-dom"+(n.hasDebugQueryParam()?".development.js":".production.min.js");a.init(n,n.getClientSpecMap(),{isMobileView:n.isMobileView(),debug:n.isDebugMode(),sdkSource:d,namespacesSdkSource:u,runtimeSource:e.get(n,["currentUrl","query","WixCodeRuntimeSource"]),ReactLibSource:p,ReactDomSource:l,ReactSource:e.get(n,["currentUrl","query","ReactSource"]),applications:r})},isAppInitiated:function(){return this._aspectSiteAPI.getWixCodeAppApi().isAppInitiated()},destroyAppsContainer:function(){this._aspectSiteAPI.getWixCodeAppApi().destroyAppsContainer()}},n}),define("wixCode/handlers/wixCodeHandlers",["lodash","zepto","utils","coreUtils","thirdPartyAnalytics","platformUtils"],function(e,t,i,n,a,s){"use strict";var r=n.linkTypes,o=function(e){if(!e.getRenderFlag("isExternalNavigationAllowed")){return e.getRenderRealtimeConfigItem("previewTooltipCallback")(function(e,t){var i=void 0!==window.screenLeft?window.screenLeft:window.screen.left,n=void 0!==window.screenTop?window.screenTop:window.screen.top,a=void 0;a=window.innerWidth?window.innerWidth:window.document.documentElement.clientWidth?window.document.documentElement.clientWidth:window.screen.width;return{top:(window.innerHeight?window.innerHeight:window.document.documentElement.clientHeight?window.document.documentElement.clientHeight:window.screen.height)/2-t/2+n,left:a/2-e/2+i}}(50,20),"text_editor_inactive_link_on_preview"),!1}return!0},d=function(t,i,n){!function(e,t){var i=e.getSiteAspect("siteMembers");i.isLoggedIn()?i.getMemberDetails(t,function(e){t(null,e)}):e.getSiteData().isPreviewMode()?i.getMemberDetailsInPreview(t,function(e){t(null,e)}):t(null,"No user is currently logged in")}(t,function(t,a){if(a)i(null,a);else{var s=e.isObject(t)&&n.extract(t);s?i(s):i(null,n.errorMsg)}})},c=function(e,t){var i=e||{};t(null,{status:i.status,responseText:i.responseText})};return{reportBI:function(e,t){e.reportBI(t.reportDef,t.params)},windowBoundingRect:function(t,i,n){var a=t.getSiteAspect("windowScrollEvent");n({window:t.getWindowSize(),scroll:e.pick(a.getScrollPosition(),["x","y"]),document:t.getDocumentSize()})},navigateTo:function(t,i){if(!t.getSiteData().isInSSR())switch(i.data.type){case r.EXTERNAL_LINK:i.data.url&&o(t)&&window.open(i.data.url,"_self");break;case r.EMAIL_LINK:var a=n.linkUtils.getEmailLink(i.data);a&&o(t)&&window.open(a,"_self");break;case r.PHONE_LINK:window.open(n.linkUtils.getPhoneLink(i.data),"_self");break;case r.DOCUMENT_LINK:var s=n.linkUtils.getDocumentLink(i.data,t.getSiteData());window.open(s,"_self");break;default:!function(t,i){var n={pageId:t.getSiteData().getPrimaryPageId()};if(i.pageId)if("#"===i.pageId)e.assign(n,{pageId:t.getSiteData().getMainPageId()});else{var a=(s=t,r=i.pageId,s.getSiteData().findDataOnMasterPageByPredicate(function(e){return e.pageUriSEO===r||e.id===r}));e.assign(n,{pageId:"masterPage"===a.id?n.pageId:a.id})}var s,r;if(i.routerId){var o=e.get(t.getSiteData(),["routers","configMap",i.routerId]),d=i.innerRoute?o.prefix+"/"+i.innerRoute:o.prefix;o&&(n={routerDefinition:o,innerRoute:i.innerRoute,pageAdditionalData:d})}i.anchorDataId&&e.assign(n,{anchorData:i.anchorDataId}),i.queryParams&&e.assign(n,{queryParams:i.queryParams}),i.tpaInnerRoute&&(e.assign(n,{tpaInnerRoute:i.tpaInnerRoute}),n.pageId===t.getSiteData().getPrimaryPageId()&&t.updatePageNavInfo(n)),t.handleNavigation(n,"#",!0)}(t,i.data)}},postHtmlMessage:function(e,t){var i=t.data;e.getSiteAspect("HtmlPostMessageAspect").postMessage(i.id,i.msg)},openLightbox:function(e,t,i){var n=t.data.id,a=e.getSiteAspect("PopupPageAspect");e.getRuntimeDal().setPopupContext(n,t.data.context),i&&a.registerCloseHandler(n,i),a.openPopupPage(n)},closeLightbox:function(e,t){var i=t.data.id;e.getCurrentPopupId()===i&&e.getSiteAspect("PopupPageAspect").closePopupPage(t.data.returnedData)},getRoutersSiteMap:function(t,n,a){var s=t.getSiteData(),r=e.find(s.routers.configMap,{prefix:n.data.prefix})||{},o=i.routersBackEndRequests.makeParamObjFromSiteData(s,r,{});i.routersBackEndRequests.getInnerRoutesSiteMap(o,function(e){a(e)},function(t){return a(null,e.get(t,"message",t))},s)},startFileUpload:function(e,t,i){e.getComponentById(t.data.compId).uploadFiles(i)},getCurrentGeolocation:function(t,i,n){window.navigator.geolocation.getCurrentPosition(function(t){n({timestamp:e.get(t,"timestamp"),coords:e.toPlainObject(e.get(t,"coords"))})},function(e){n(null,e&&e.message)})},scrollToComponent:function(e,t,i){e.scrollToComponent(t.data.compId,{onComplete:function(){i()}})},smCurrentUserEmail:function(e,t,i){d(e,i,{extract:function(e){return e.email},errorMsg:"Unable to retrieve user email"})},smCurrentUserSlug:function(e,t,i){d(e,i,{extract:function(e){return e.slug},errorMsg:"Unable to retrieve user slug"})},smLogout:function(e,t,i){var a=e.getSiteAspect("siteMembers");if(a.isLoggedIn()){var s=t.data?function(){if(t.data.type===r.EXTERNAL_LINK&&t.data.url&&o(e))window.open(t.data.url,"_self");else{var i={pageId:{id:t.data.pageId},type:t.data.type,queryParams:t.data.queryParams},a=e.getSiteData(),s=n.linkRenderer.renderLink(i,a,a.getRootNavigationInfo());e.href(s.href)}}:null;a.logout(null,i,function(e){return i(null,e)},{navigateToPage:s})}else i(null,"No member is logged in")},smForgotPassword:function(t,i,n){var a=e.get(i,["data","language"]),s=t.getSiteAspect("siteMembers"),r=!1;s.isLoggedIn()?n(null,"User is already logged in"):s.showResetPasswordDialog(a||null,function(){r=!0},function(){r?n():n(null,"The user closed the forgot password dialog")})},googleAnalytics:function(e,t){a.reportGoogleAnalytics.apply(null,[e.getSiteData()].concat(t.data))},sendMessageToParent:function(e,t){window.parent!==window&&e.getSiteData().isViewerMode()&&window.parent.postMessage(t.data,"*")},sendUserEmail:function(t,n,a){var s=e.find(t.getSiteData().getClientSpecMap(),{appDefinitionId:"135c3d92-0fea-1f9d-2ba5-2a1dfb04297e"});if(e.get(s,"instance")){var r=n.data,o=r.emailId,d=r.contactId,u=r.options;if("user"!==r.type||t.getSiteAspect("siteMembers").isLoggedIn()){var p=t.getSiteData().getExternalBaseUrl().replace(/\/$/,"");i.ajaxLibrary.ajax({url:p+"/_api/shoutout/v1/emailContact",type:"POST",dataType:"json",contentType:"application/json",data:JSON.stringify({emailId:o,contactId:d,options:u}),processData:!1,headers:{Authorization:s.instance},success:function(){a()},error:function(e){c(e,a)}})}else a(null,"User must be logged-in in order to send an email")}else a(null,"shoutout app not installed")},openMessageChannel:function(t,i,n,a){if(window.parent!==window&&t.getSiteData().isViewerMode()){var s=i.data;e.isString(s)&&(s=JSON.parse(i.data));var r=t.getSiteAspect("wixCodeMessageChannelAspect").getMessageChannel(s.appDefinitionId);n({appDefinitionId:s.appDefinitionId},null,a?[r.port2]:[r.port1])}else n(null,"DID NOT CREATE MESSAGE CHANNEL")},smRegisterUser:function(t,i,n){var a=e.get(i,["data","email"]),r=e.get(i,["data","password"]),o=e.get(i,["data","contactInfo"],{}),d=s.platformizedEndpointsUtils.contacts.serializeContactInfo(o);t.getSiteAspect("siteMembers").registerUser(a,r,d,function(t,i){if(t){var a={status:"ACTIVE"===t.member.status?"ACTIVE":"PENDING",memberData:e.omit(t.member,"status")};t.approvalToken&&(a.approvalToken=t.approvalToken),n(a)}else c(i,n)})},smApplySessionToken:function(t,i,n){var a=e.get(i,["data","token"]);t.getSiteAspect("siteMembers").authenticateSession(a,function(e){e?n(null,"sessionToken token is invalid"):n()})},crmCreateContact:function(t,n,a){var r=e.find(t.getSiteData().getClientSpecMap(),{appDefinitionId:"675bbcef-18d8-41f5-800e-131ec9e08762"});if(e.get(r,"instance")){var o=n.data.contactInfo;i.ajaxLibrary.ajax({url:"/_api/wix-contacts-webapp/v3/contacts",type:"POST",dataType:"json",contentType:"application/json",data:JSON.stringify({contact:s.platformizedEndpointsUtils.contacts.serializeContactInfo(o)}),processData:!1,headers:{Authorization:"wixcode-pub."+r.instance},success:function(e){a(e)},error:function(e){c(e,a)}})}else a(null,"wix code is not enabled")}}}),define("wixCode/services/platformTpaApiService",["lodash","pmrpc","utils"],function(e,t,i){"use strict";function n(e,n,a,s,r){return t.api.request("publicApi",{initiator:n}).then(function(t){if(!t[a])throw new Error("Api for component with id "+e+" does not contain function "+a);return t[a].apply(t,s)}).then(r).catch(function(e){i.log.error(e.message),r(null,e.message)})}function a(e){var t=e.getIframe();return t&&t.id}return{handleAppAPIMessage:function(t,s,r){var o=t.getSiteAspect("tpaComponentsDomAspect"),d=e.get(s.data,"compId");o.getComponentWhenReady(d).then(function(t){if(!t)throw new Error("comp "+d+" does not exist");var i=e.get(s.data,"fn"),o=e.get(s.data,"fnArgs");switch(s.type){case"invokeAppFn":n(d,a(t),i,o,r);break;case"invokeAppOn":n(d,a(t),i,[r],r)}}).catch(function(e){i.log.error(e.message),r(null,e.message)})}}}),define("wixCode/utils/constants",[],function(){"use strict";return{MESSAGE_INTENT:{WIX_CODE_MESSAGE:"WIX_CODE",WIX_CODE_SITE_API:"WIX_CODE_SITE_API",WIX_CODE_APP_API:"WIX_CODE_APP_API",SANTA_APPLICATION_CHANNEL_MESSAGE_RESPONSE:"SANTA_APPLICATION_CHANNEL_MESSAGE_RESPONSE",SANTA_APPLICATION_CHANNEL_MESSAGE:"SANTA_APPLICATION_CHANNEL_MESSAGE"},MESSAGE_TYPE:{CONSOLE:"console",IFRAME_COMMAND:"wix_code_iframe_command",GOOGLE_ANALYTICS:"googleAnalytics",UPDATE_WIX_CODE_MODEL_DATA_AFTER_LOGIN:"update_wix_code_model_data_after_login",REQUEST_API:"REQUEST_API",PERFORMANCE_METRICS_READY:"performance_metrics_ready",PLATFORM_PUBLIC_API_PREFIX:"viewer_platform_public_api_",OPEN_MESSAGE_CHANNEL:"openMessageChannel",SANTA_READY:"santaReady",SANTA_PAGE_CHANGE:"santaPageChange"}}}),define("wixCode/services/wixCodeUserScriptsService",["lodash","coreUtils","experiment"],function(e,t,i){"use strict";var n=t.urlUtils,a="pages",s=".js",r=s+".map",o=["wixCode","nonUndoable","bundleCacheKillers"],d=["wixCode","nonUndoable","defaultBundleCacheKiller"];function c(t,i){var n=e.get(i,o,{}),a=e.get(i,d);return n[t]||a}function u(e,t){return n.joinURL("https://"+e.instanceId+".dev."+t.serviceTopology.wixCloudBaseDomain,a)}function p(e,t,i,s,r){return"site"===r.viewMode?function(e,t,i,s,r){var o="https://"+s.instanceId+".static.pub."+r.serviceTopology.wixCloudBaseDomain;return n.joinURL(o,"static","v2",i.appData.codeAppId,s.instanceId,a,e)+"?empty-if-missing=true&exclude=wix-&module-name="+t}(e,t,i,s,r):function(e,t,i,a,s){var r=u(a,s);return n.joinURL(r,e)+"?empty-if-missing=true&exclude=wix-&module-name="+t+"&viewMode="+s.viewMode+"&instance="+a.instance+"&scari="+i.signedAppRenderInfo+"&cacheKiller="+c(t,s)}(e,t,i,s,r)}function l(t){return e.startsWith(t,"public/pages/")}return{paths:{GLOBAL_CACHE_KILLER:d,CACHE_KILLERS_MAP:o},filePathAffectsBundles:function(t){return e.startsWith(t,"public/")||e.startsWith(t,"backend/")},filePathAffectsSingleBundle:l,bundleIdFromFilePath:function(e){if(!l(e))throw new Error('The path "'+e+'" does not belong to a single bundle');return e.split("public/pages/")[1].split(".")[0]},getUserScript:function(e,t,i,n){var a="masterPage"===e.type?"masterPage":e.id,s=a+".js";return{url:p(s,a,t,i,n),displayName:(r=e,"masterPage"===r.type?"site":r.displayName+" "+("Popup"===r.type?"popup":"page")),scriptName:s};var r},isUserCodeUrl:function(t,i,n){var a=u(i,n);return e.startsWith(t,a)},getSourceMapUrl:function(e,t,o,d){var u=function(e){var t=e.substring(0,e.indexOf(s));return t.substring(t.lastIndexOf("/")+1)}(e),p=i.isOpen("sv_wixCodeNewDomain",d)?"//"+o.instanceId+".dev.wix-code.com/preview":"//editor."+d.serviceTopology.baseDomain+"/_api/wix-code-dev-dispatcher/preview/";return n.joinURL(p,a,u+r)+"?module-name="+u+"&viewMode="+d.viewMode+"&instance="+o.instance+"&scari="+t+"&cacheKiller="+c(u,d)}}}),define("wixCode/utils/messageBuilder",["lodash","wixCode/services/wixCodeUserScriptsService","wixCode/utils/constants"],function(e,t,i){"use strict";return{getExtendedMessage:function(n,a,s,r){var o={intent:i.MESSAGE_INTENT.WIX_CODE_MESSAGE};return s&&n.widgets&&(n.widgets=e.map(n.widgets,function(o){return"Application"!==(d=o).type||"dataBinding"===d.id?e.assign({},o,function(e,n,a,s,r){if("load_widgets"===e.type||"load_user_code"===e.type||e.type===i.MESSAGE_TYPE.UPDATE_WIX_CODE_MODEL_DATA_AFTER_LOGIN){var o={appConfig:{scari:a.signedAppRenderInfo,instance:s.instance}};return"Application"!==n.type&&(o.appConfig.userScript=t.getUserScript(n,a,s,r)),o}}(n,o,a,s,r)):o;var d})),e.defaults({},n,o)}}}),define("wixCode/aspects/wixCodePostMessageService",["lodash","tpa","utils","coreUtils","wixCode/handlers/wixCodeHandlers","wixCode/services/platformTpaApiService","wixCode/utils/constants","wixCode/utils/messageBuilder","wixCode/utils/wixCodeWidgetService","widgets","pmrpc"],function(e,t,i,n,a,s,r,o,d,c,u){"use strict";function p(e){return e===r.MESSAGE_INTENT.WIX_CODE_SITE_API}function l(e){return e===r.MESSAGE_INTENT.WIX_CODE_APP_API}function g(e){return e.getSiteAspect("WidgetAspect").getWidgetHandler(e)}function f(e,t,n){var a=g(e);switch(t.type){case r.MESSAGE_TYPE.IFRAME_COMMAND:a.onCommand(t,n);break;case r.MESSAGE_TYPE.CONSOLE:i.logWixCodeConsoleMessage(t);break;case r.MESSAGE_TYPE.REQUEST_API:if(!e.getSiteData().isAddPanelView){var s=r.MESSAGE_TYPE.PLATFORM_PUBLIC_API_PREFIX+t.appDefId+"_"+t.workerId;u.api.request(s,{target:a.getPostMessageTarget(t.workerId)}).then(function(e){u.api.set(s,e)})}break;case r.MESSAGE_TYPE.PERFORMANCE_METRICS_READY:"undefined"!=typeof window&&window.postMessage(t,"*");break;default:a.handleRemoteMessage(t)}}function m(i,n,o){try{e.isString(n)&&(n=JSON.parse(n))}catch(e){return}if(i.getSiteData().isInSSR()?n:function(t,i,n){if(e.get(i,"data.requiresDom")){var a=t.getSiteAspect("wixCodeMessageQueueAspect");if(a.shouldQueueMessage(i))return a.addMessageToQueue(i.data.requiresDom.compId,i,n),null;delete i.data.requiresDom}return i}(i,n,o)){var d=void 0;if(n.intent===r.MESSAGE_INTENT.WIX_CODE_MESSAGE)o(n,A(n,g(i)));else if(p(n.intent)){var c=e.defaults({},a,t.tpaHandlers);if(d=A(n,g(i)),c[n.type])try{c[n.type](i,n,d)}catch(e){d(null,e.message)}}else if(l(n.intent)){d=A(n,g(i));try{s.handleAppAPIMessage(i,n,d)}catch(e){d(null,e.message)}}}}function A(t,i){return function(n,a,s){var r={intent:"WIX_CODE_RESPONSE",callbackId:t.callbackId,type:t.type,contextId:t.contextId};if(p(t.intent)||l(t.intent))r=e.merge(r,{result:n,error:a});else{var o={compId:t.compId,command:t.command};n&&e.merge(o,n),r=e.merge(r,{result:o})}try{i.updateComponent(r,s)}catch(e){}}}return{handleMessage:function(t,i,n){m(t,i,n||e.partial(f,t))},getWidgetHandler:g,modifyPostMessage:function(e,t){var i=e.getSiteData(),n=i.rendererModel.wixCodeModel,a=d.getWixCodeSpec(i.getClientSpecMap());return o.getExtendedMessage(t,n,a,i)},registerMessageHandler:function(t,i){t.getWixCodeAppApi().registerMessageHandler(e.partial(i,t))},registerMessageModifier:function(t,i){t.getWixCodeAppApi().registerMessageModifier(e.partial(i,t))},onMessage:m}}),define("wixCode/aspects/WixCodePostMessageAspect",["wixCode/aspects/wixCodePostMessageService"],function(e){"use strict";return function(t){this.siteAPI=t,e.registerMessageHandler(this.siteAPI,e.handleMessage),e.registerMessageModifier(this.siteAPI,e.modifyPostMessage)}}),define("wixCode/aspects/hooksHandlers/repeaterHooks",["lodash","coreUtils"],function(e,t){"use strict";var i=t.dataResolver;return{handleRepeaterDataChange:function(n,a,s){var r=this.siteAPI,o=a.value,d=r.getRuntimeDal().getCompPointer(n);!function(n,a,s){if(!e.isEmpty(s)){var r=n.getSiteData(),o=n.getPointers(),d=n.getRuntimeDal(),c=o.components.getPageOfComponent(a).id,u=o.full.components.getChildrenRecursively(a);e.forEach(u,function(a){var u=e.replace(n.getSiteDataAPI().document.getFullStructureProperty(a,"dataQuery"),"#",""),p=e.replace(n.getSiteDataAPI().document.getFullStructureProperty(a,"designQuery"),"#","");if(u){var l=e.defaults({},d.getCompDataOverrides(a.id),r.getDataByQuery(u,c));e.forEach(s,function(s){var d=t.displayedOnlyStructureUtil.getUniqueDisplayedId(a.id,s),p=i.cloneDataItemWithNewRefIdsRecursively(l,r.dataTypes.DATA,"_runtime_",r.getClonedDataItemsIdsMap(d));p.id=t.displayedOnlyStructureUtil.getUniqueDisplayedId(u,s);var g=i.getFlatMapOfNestedItem(p,r.dataTypes.DATA);e.forOwn(g,function(e){n.getDisplayedDAL().set(o.data.getDataItem(e.id,c),e)})})}if(p){var g=e.defaults({},d.getCompDesignOverrides(a.id),r.getDataByQuery(p,c,r.dataTypes.DESIGN));e.forEach(s,function(s){var d=t.displayedOnlyStructureUtil.getUniqueDisplayedId(a.id,s),u=i.cloneDataItemWithNewRefIdsRecursively(g,r.dataTypes.DESIGN,"_runtime_",r.getClonedDataItemsIdsMap(d));u.id=t.displayedOnlyStructureUtil.getUniqueDisplayedId(p,s);var l=i.getFlatMapOfNestedItem(u,r.dataTypes.DESIGN);e.forOwn(l,function(e){n.getDisplayedDAL().set(o.data.getDesignItem(e.id,c),e)})})}var f=d.getCompBehaviorsOverrides(a.id);e.isEmpty(f)||e.forEach(s,function(e){d.addActionsAndBehaviors(t.displayedOnlyStructureUtil.getUniqueDisplayedId(a.id,e),f)});var m=d.getCompPropsOverrides(a.id);e.isEmpty(m)||e.forEach(s,function(e){d.setCompProps(t.displayedOnlyStructureUtil.getUniqueDisplayedId(a.id,e),m)})})}}(r,d,e.difference(o.items,s.items)),function(n,a,s){if(!e.isEmpty(s)){var r=n.getSiteData(),o=n.getPointers(),d=o.components.getPageOfComponent(a).id,c=o.full.components.getChildrenRecursively(a);e.forEach(c,function(a){var c=e.replace(n.getSiteDataAPI().document.getFullStructureProperty(a,"dataQuery"),"#",""),u=e.replace(n.getSiteDataAPI().document.getFullStructureProperty(a,"designQuery"),"#",""),p=n.getRuntimeDal();e.forEach(s,function(s){var l=t.displayedOnlyStructureUtil.getUniqueDisplayedId(a.id,s);if(p.clearCompRuntimeOverrides(l),c){var g=t.displayedOnlyStructureUtil.getUniqueDisplayedId(c,s),f=r.getDataByQuery(g,d),m=i.getFlatMapOfNestedItem(f,r.dataTypes.DATA,!0);e.forOwn(m,function(e,t){n.getDisplayedDAL().remove(o.data.getDataItem(t,d))})}if(u){var A=t.displayedOnlyStructureUtil.getUniqueDisplayedId(u,s),S=r.getDataByQuery(A,d,r.dataTypes.DESIGN),h=i.getFlatMapOfNestedItem(S,r.dataTypes.DESIGN);e.forOwn(h,function(e,t){n.getDisplayedDAL().remove(o.data.getDesignItem(t,d))})}})})}}(r,d,e.difference(s.items,o.items)),r.getSiteDataAPI().createDisplayedNode(d)}}}),define("wixCode/aspects/hooksHandlers/matrixGalleryDataHook",["lodash","galleriesCommon","coreUtils"],function(e,t,i){"use strict";var n=t.utils.galleriesHelperFunctions,a=i.matrixCalculations;return{setCompLayoutOnDataChange:function(e,t,i){if("ImageList"===t.value.type){var s=this.siteAPI.getRuntimeDal(),r=s.getCompData(e),o=s.getCompProps(e),d=s.getCompLayout(e),c=s.getCompStructure(e),u=i.items,p=r.items,l=d.height,g=a.getAvailableRowsNumber(o.maxRows,o.numCols,u.length),f=a.getAvailableRowsNumber(o.maxRows,o.numCols,p.length),m=Math.max(n.MIN_GALLERY_HEIGHT,n.getGalleryHeight(g,f,o.margin,c.skin,l));s.updateCompLayout(e,{height:m})}}}}),define("wixCode/aspects/wixCodeChangeHooksAspect",["lodash","wixCode/aspects/hooksHandlers/repeaterHooks","wixCode/aspects/hooksHandlers/matrixGalleryDataHook"],function(e,t,i){"use strict";function n(t){this.siteAPI=t,this.DATA="dataChange",this.compsPlugin={dataChange:{}},this.registerListeners();var i=this.handleRuntimeDalCompChange.bind(this);t.getRuntimeDal().registerChangeListener(i),this.applySsrChanges=function(t){e.forEach(this.siteAPI.getSiteData().pendingRuntimeDalChanges,function(e){t(e.compId,e.changeObject,e.dataBeforeChange)})}.bind(this,i)}n.prototype={getSiteAPI:function(){return this.siteAPI},getPlugin:function(e,t){return this.compsPlugin[e.type]&&this.compsPlugin[e.type][t]?this.compsPlugin[e.type][t]:null},handleRuntimeDalCompChange:function(e,t,i){var n=this.getSiteAPI().getRuntimeDal().getCompStructure(e);if(t&&n&&n.componentType){var a=this.getPlugin(t,n.componentType);a&&a.call(this,e,t,i)}},registerListeners:function(){this.registerCompListener(this.DATA,"wysiwyg.viewer.components.MatrixGallery",i.setCompLayoutOnDataChange),this.registerCompListener(this.DATA,"wysiwyg.viewer.components.Repeater",t.handleRepeaterDataChange)},registerCompListener:function(e,t,i){this.compsPlugin[e][t]=i}};return n}),define("wixCode/aspects/wixCodeMessageQueueAspect",["lodash","utils","coreUtils","wixCode/aspects/wixCodePostMessageService"],function(e,t,i,n){"use strict";function a(e){this.aspectSiteAPI=e,this.siteAPI=e.getSiteAPI(),this.messageQueue=[],this._currentPageId=null,e.registerToDidLayout(this.flushQueue.bind(this)),e.registerToOnRendered(function(){this._currentPageId=this.siteAPI.getSiteData().getCurrentUrlPageId(),this.flushQueueOnRender()}.bind(this)),e.registerToUrlPageChange(function(){this._currentPageId=null}.bind(this))}function s(i,n){var a=e.keys(i.getComponentsByPageId(t.siteConstants.MASTER_PAGE_ID)),s=e.keys(i.getComponentsOnFocusedPage()),r=e.union(a,s);return e.includes(r,n)}return a.prototype={flushQueueOnRender:function(){e.forEach(this.messageQueue,function(t,a){!e.isNil(t)&&(t.compId===i.constants.COMP_IDS.WINDOW&&this._currentPageId===t.message.contextId)&&(delete t.message.data.requiresDom,n.onMessage(this.siteAPI,t.message,t.handler),this.messageQueue.splice(a,1))}.bind(this))},flushQueue:function(){e.forEach(this.messageQueue,function(e,t){e&&s(this.siteAPI,e.compId)&&(delete e.message.data.requiresDom,n.onMessage(this.siteAPI,e.message,e.handler),this.messageQueue.splice(t,1))}.bind(this))},addMessageToQueue:function(e,t,i){this.messageQueue.push({compId:e,message:t,handler:i})},shouldQueueMessage:function(t){var n=e.get(t,"data.requiresDom.compId");return n===i.constants.COMP_IDS.WINDOW?this._currentPageId!==t.contextId:!s(this.siteAPI,n)}},a}),define("wixCode/aspects/wixCodeMessageChannelAspect",["lodash","wixCode/utils/constants","wixCode/handlers/wixCodeHandlers","tpa"],function(e,t,i,n){"use strict";function a(a){var s=this,r=a.data;if(e.isString(r)&&(r=JSON.parse(a.data)),r.intent===t.MESSAGE_INTENT.SANTA_APPLICATION_CHANNEL_MESSAGE){switch(r.type){case t.MESSAGE_TYPE.OPEN_MESSAGE_CHANNEL:n.tpaHandlers.waitForWixCodeWorkerToBeReady(this.siteAPI,a,function(){i[r.type](s.siteAPI,a,(n=a,function(i,a,s){var r=e.assign(i,{intent:t.MESSAGE_INTENT.SANTA_APPLICATION_CHANNEL_MESSAGE_RESPONSE,type:n.data.type,error:a,callbackId:n.data.callbackId});window.parent.postMessage(r,"*",s)}),!0);var n})}}}function s(e){this.aspectSiteAPI=e,this.siteAPI=e.getSiteAPI(),this.messageChannel={},this.siteAPI.getSiteData().isInSSR()||window.parent!==window&&this.siteAPI.getSiteData().isViewerMode()&&(this.aspectSiteAPI.registerToMessage(a.bind(this)),this.aspectSiteAPI.registerToSiteReady(function(){var e={intent:t.MESSAGE_INTENT.SANTA_APPLICATION_CHANNEL_MESSAGE_RESPONSE,type:t.MESSAGE_TYPE.SANTA_READY};window.parent.postMessage(e,"*")}.bind(this)),this.aspectSiteAPI.registerToUrlPageChange(function(){this.messageChannel={};var e={intent:t.MESSAGE_INTENT.SANTA_APPLICATION_CHANNEL_MESSAGE_RESPONSE,type:t.MESSAGE_TYPE.SANTA_PAGE_CHANGE};window.parent.postMessage(e,"*")}.bind(this)))}return s.prototype={getMessageChannel:function(e){return this.messageChannel[e]?this.messageChannel[e]:(this.messageChannel[e]=new MessageChannel,this.messageChannel[e])}},s}),define("wixCode/aspects/wixCodeAspectCollector",["core","wixCode/aspects/WixCodeWidgetAspect","wixCode/aspects/WixCodePostMessageAspect","wixCode/aspects/wixCodeChangeHooksAspect","wixCode/aspects/wixCodeMessageQueueAspect","wixCode/aspects/wixCodeMessageChannelAspect"],function(e,t,i,n,a,s){"use strict";var r=e.siteAspectsRegistry;r.registerSiteAspect("wixCodeWidgetAspect",t),r.registerSiteAspect("wixCodePostMessageAspect",i),r.registerSiteAspect("wixCodeChangeHooksAspect",n),r.registerSiteAspect("wixCodeMessageQueueAspect",a),r.registerSiteAspect("wixCodeMessageChannelAspect",s)}),define("wixCode/utils/kibanaReporter",["lodash","utils"],function(e,t){"use strict";var i={INFO:"info",WARN:"warn",ERROR:"error"},n=/\[request-id:\s(\d+\.\d+)\]/,a=e.noop,s=[-12,-15,-16],r="Message was not specified although level is error. See stack_trace",o=["ReactSource","EditorSource","experiments","petri_ovr","WixCodeRuntimeSource","js-wixcode-sdk-override","debug"];function d(){var i,n=e.get(window.parent,"location.href"),a=t.urlUtils.parseUrl(n),s=Object.keys(a.query).some(function(e){return"wixCodeForceKibanaReport"===e}),r=!!n&&(i=n,e.includes(i,"://localhost")||function(i){var n=t.urlUtils.parseUrl(i);return Object.keys(n.query).some(function(t){return e.includes(o,t)})}(n));return s||!r}function c(i,n,s){if("undefined"!=typeof window&&d()&&(!window.isMockWindow||"undefined"==typeof global||global.jasmine.isSpy(t.ajaxLibrary.ajax))){s||(s=1);var r,o=(r=i,e.flow(l,g,f,A,S,m,w,u,C,I)(r));(function(e,i){var n={type:"POST",url:e+"/logstash/events",dataType:"json",contentType:"application/json",data:JSON.stringify(i),xhrFields:{withCredentials:!0},crossDomain:!0};return new Promise(function(e,i){n.success=e,n.error=function(e,t,n){i({xhr:e,errorType:t,error:n})},t.ajaxLibrary.ajax(n)})})(n,o).then(a,function(){s>2?function(t){var i="wixCodePendingMonitoring",n=window.localStorage.getItem(i),a=void 0;try{var s=n?JSON.parse(n):[];a=e.isArray(s)?s:[]}catch(e){a=[]}var r=JSON.stringify(a.concat(t));try{window.localStorage.setItem(i,r)}catch(e){}}(o):c(i,n,s+1),a()})}}function u(t){if(!e.isError(t.message))return t;var i=t.message,n={};return i.stack?(n.stackTrace=i.stack,n.message=i.message):n.message=i.toString(),e.merge({},t,n)}function p(t){return e.isError(t)&&!!t.xhr}function l(t){if(!p(t.message))return t;var i=e.pickBy(e.assign({x_seen_by:t.message.xhr.getResponseHeader("x-seen-by")},e.mapKeys(e.get(t,"message.request.headers"),function(t,i){return e.snakeCase(i)})));return e.merge({},t,{params:i})}function g(t){if(!p(t.message))return t;var i=function(e){var t=n.exec(e);if(t&&t[1])return t[1]}(h(t.message.xhr.responseText).errorDescription);return i?e.merge({},t,{requestId:i}):t}function f(t){if(!p(t.message))return t;var i=h(t.message.xhr.responseText).errorCode;return e.isNil(i)?t:e.merge({},t,{errorCode:i.toString()})}function m(t){if(!p(t.message))return t;var n=h(t.message.xhr.responseText).errorCode;return n&&e.includes(s,n)?e.merge({},t,{level:i.WARN}):t}function A(t){return n=t.message,e.isError(n)&&"RequestAbortError"===n.name?e.merge({},t,{level:i.WARN}):t;var n}function S(t){return n=t.message,e.isError(n)&&"RequestTimeoutError"===n.name?e.merge({},t,{level:i.WARN}):t;var n}function h(e){if(!e)return{};try{return JSON.parse(e)}catch(e){return{}}}function w(t){return t.message||t.level!==i.ERROR?t:e.merge({},t,{message:new Error(r)})}function C(t){return e.isString(t.message)?t:e.merge({},t,{message:JSON.stringify(t.message)})}function I(t){return e.merge({},t,{params:{url:e.get(window,"location.href","")}})}return{levels:i,trace:function(n,a){!function(t){if(!e.isString(t)||0===t.length)throw new Error("parameter `baseUrl` is invalid, received: "+t)}(a);var s=new Date,r=s.getTime(),o=e.merge({},{source:"wix-code-client",level:i.INFO,userActionId:t.guidUtils.getGUID()},n,{timestamp:s.toJSON(),actionPosition:"start"});return c(o,a),function(t){var i=new Date,n=(i.getTime()-r)/1e3;c(t=e.merge({},o,t,{timestamp:i.toJSON(),duration:n,actionPosition:"end"}),a)}},_setResponseCallback:function(t){a=t||e.noop}}}),define("wixCode/skins/skins.json",[],function(){"use strict";var e={};return e["wysiwyg.viewer.skins.WixCodeWidgetSkin"]={react:[["iframe","iframe",[],{}]],css:{"% iframe":"display:none;"}},e}),define("wixCode",["wixCode/utils/wixCodeWidgetService","wixCode/aspects/wixCodeAspectCollector","wixCode/utils/messageBuilder","wixCode/utils/kibanaReporter","wixCode/services/wixCodeUserScriptsService","wixCode/aspects/wixCodePostMessageService","skins","wixCode/skins/skins.json"],function(e,t,i,n,a,s,r,o){"use strict";return r.skinsMap.addBatch(o),{wixCodeWidgetService:e,log:n,messageBuilder:i,wixCodeUserScriptsService:a,wixCodePostMessageService:s}});
//# sourceMappingURL=wixCode.min.js.map